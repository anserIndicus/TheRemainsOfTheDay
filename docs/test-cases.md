# TheRemainsOfTheDay 浏览器扩展测试用例文档

## 目录
1. [内容采集测试](#1-内容采集测试)
2. [存储测试](#2-存储测试)
3. [报告生成测试](#3-报告生成测试)
4. [性能测试](#4-性能测试)
5. [错误处理测试](#5-错误处理测试)

## 1. 内容采集测试

### 1.1 基础内容采集enum ContentType {
  TEXT = 'text',
  PAGE = 'page',
  USER_INPUT = 'user_input',
  SOCIAL_POST = 'social_post',
  SEARCH = 'search'
}private processContent(element: Element): void {
  if (!this.enabled) return;
  const content = element.textContent?.trim();
  if (!content || content.length < this.options.minTextLength) return;

  const contentItem = this.createContentItem(element);
  this.processContentItem(contentItem);
}

private processNode(node: Node): void {
  if (node.nodeType === Node.ELEMENT_NODE) {
    this.processContent(node as Element);
  }
  node.childNodes.forEach(child => this.processNode(child));
}interface ImportanceWeights {
  baseWeight: number;
  timeMultiplier: number;
}

private static calculateWeight(content: ContentItem): number {
  const weights: ImportanceWeights = {
    baseWeight: 1,
    timeMultiplier: 1
  };
  return weights.baseWeight * weights.timeMultiplier;
}

static extractContent(element: Element, type: ContentType): string {
  switch (type) {
    case ContentType.TEXT:
      return this.extractTextContent(element);
    case ContentType.PAGE:
      return this.extractPageContent(element);
    case ContentType.USER_INPUT:
      return this.extractUserInput(element);
    case ContentType.SOCIAL_POST:
      return this.extractSocialFeedContent(element);
    case ContentType.SEARCH:
      return this.extractTextContent(element);
    default:
      return this.extractTextContent(element);
  }
}
#### TC-001: 启动内容采集
- **前置条件**：Chrome浏览器已安装扩展
- **测试步骤**：
  1. 点击扩展图标
  2. 启用采集功能
  3. 导航到测试网页
- **预期结果**：
  - 采集开始
  - 状态指示器显示活动状态
  - 通知提示采集已开始

#### TC-002: 停止内容采集
- **前置条件**：采集功能处于活动状态
- **测试步骤**：
  1. 点击扩展图标
  2. 禁用采集功能
- **预期结果**：
  - 采集停止
  - 状态指示器显示非活动状态
  - 通知提示采集已停止

### 1.2 内容提取
#### TC-003: 文本内容提取
- **前置条件**：采集功能已启用
- **测试步骤**：
  1. 访问包含各种文本内容的测试页面
  2. 滚动浏览页面
- **预期结果**：
  - 长度超过`minTextLength`的文本内容被采集
  - 长度小于`minTextLength`的内容被忽略
  - 排除的元素（script、style等）未被采集
  - 采集的内容包含正确的元数据

#### TC-004: 元数据提取
- **前置条件**：采集功能已启用
- **测试步骤**：
  1. 访问包含作者、点赞数、评论数等元数据的页面
  2. 启用采集
- **预期结果**：
  - 作者信息正确提取
  - 点赞数正确提取
  - 评论数正确提取
  - 元数据与内容正确关联

### 1.3 用户交互跟踪
#### TC-005: 点击跟踪
- **前置条件**：采集功能已启用
- **测试步骤**：
  1. 点击页面上的各种元素
  2. 查看交互记录
- **预期结果**：
  - 点击事件被记录
  - 包含正确的目标元素信息
  - 时间戳准确

#### TC-006: 滚动跟踪
- **前置条件**：采集功能已启用
- **测试步骤**：
  1. 在页面中进行滚动
  2. 查看交互记录
- **预期结果**：
  - 滚动事件被记录
  - 包含正确的时间戳
  - 滚动位置信息准确

#### TC-007: 焦点跟踪
- **前置条件**：采集功能已启用
- **测试步骤**：
  1. 在不同标签页/窗口间切换
  2. 查看活动时间记录
- **预期结果**：
  - 焦点获得和失去事件被记录
  - 活动时间计算准确
  - 包含正确的时间戳

### 1.4 禁用功能测试
#### TC-019: 禁用后重新启用
- **前置条件**：
  - 采集功能已启用
  - 页面上已有采集的内容
- **测试步骤**：
  1. 启用禁用功能
  2. 确认当前页面记录被清理
  3. 关闭禁用功能
  4. 继续在页面上操作
- **预期结果**：
  - 启用禁用时，当前页面的历史记录被清理
  - 关闭禁用后，新的内容开始被记录
  - 时间记录从关闭禁用的时刻开始计算
  - 新的内容采集正确创建并记录

#### TC-020: 禁用状态持久化
- **前置条件**：特定页面已被禁用
- **测试步骤**：
  1. 关闭并重新打开浏览器
  2. 访问之前禁用的页面
- **预期结果**：
  - 禁用状态被正确保持
  - 不会自动开始采集
  - 禁用状态在扩展UI中正确显示

#### TC-021: 禁用状态切换
- **前置条件**：有多个标签页打开
- **测试步骤**：
  1. 在一个标签页中启用禁用
  2. 切换到其他标签页
  3. 返回禁用的标签页
- **预期结果**：
  - 禁用状态仅影响指定的标签页
  - 其他标签页的采集状态不受影响
  - 切换回禁用标签页时禁用状态保持

## 2. 存储测试

### 2.1 数据库操作
#### TC-008: 内容存储
- **前置条件**：数据库已初始化
- **测试步骤**：
  1. 启用采集
  2. 生成测试内容
  3. 检查数据库
- **预期结果**：
  - 内容被正确存储
  - 数据结构完整
  - 元数据关联正确

#### TC-009: 内容采集管理
- **前置条件**：数据库已初始化
- **测试步骤**：
  1. 启动多个页面的内容采集
  2. 结束部分页面的采集
  3. 检查数据库
- **预期结果**：
  - 活动采集状态追踪正确
  - 采集时间戳准确
  - 时间追踪数据完整

### 2.2 数据清理
#### TC-010: 删除页面记录
- **前置条件**：数据库中存在多个页面的记录
- **测试步骤**：
  1. 选择特定页面
  2. 执行记录删除
- **预期结果**：
  - 目标页面记录被删除
  - 其他页面记录保持不变
  - 返回正确的删除计数

#### TC-011: 删除域名记录
- **前置条件**：数据库中存在多个域名的记录
- **测试步骤**：
  1. 选择特定域名
  2. 执行记录删除
- **预期结果**：
  - 目标域名的所有记录被删除
  - 其他域名记录保持不变
  - 返回正确的删除计数

## 3. 报告生成测试

### 3.1 日报生成
#### TC-012: 生成日报
- **前置条件**：存在当日的采集数据
- **测试步骤**：
  1. 触发日报生成
  2. 检查报告内容
- **预期结果**：
  - 报告包含所有采集内容
  - 时间追踪数据汇总正确
  - 内容分类准确

### 3.2 数据导出
#### TC-013: 导出功能
- **前置条件**：数据库中存在测试数据
- **测试步骤**：
  1. 选择导出格式
  2. 执行导出操作
- **预期结果**：
  - 数据格式正确
  - 包含所有必要字段
  - 导出文件可以正常打开

## 4. 性能测试

### 4.1 资源使用
#### TC-014: 内存使用
- **前置条件**：浏览器处于正常状态
- **测试步骤**：
  1. 在内容密集的页面启用采集
  2. 监控内存使用
- **预期结果**：
  - 内存使用稳定
  - 无明显内存泄漏
  - 资源占用在合理范围内

#### TC-015: CPU使用
- **前置条件**：浏览器处于正常状态
- **测试步骤**：
  1. 启用采集并进行各种交互
  2. 监控CPU使用
- **预期结果**：
  - CPU使用率保持在合理范围
  - 无明显性能卡顿
  - 后台进程资源占用适中

### 4.2 存储限制
#### TC-016: 数据库大小限制
- **前置条件**：数据库已初始化
- **测试步骤**：
  1. 生成大量测试数据
  2. 监控存储使用
- **预期结果**：
  - 数据存储效率高
  - 遵守存储限制
  - 旧数据管理得当

## 5. 错误处理测试

### 5.1 恢复场景
#### TC-017: 浏览器崩溃恢复
- **前置条件**：采集功能已启用
- **测试步骤**：
  1. 模拟浏览器崩溃
  2. 重启浏览器
- **预期结果**：
  - 扩展正常恢复
  - 无数据丢失
  - 内容采集状态正确恢复

#### TC-018: 网络错误处理
- **前置条件**：采集功能已启用
- **测试步骤**：
  1. 模拟网络问题
  2. 观察错误处理
- **预期结果**：
  - 错误被优雅处理
  - 适当的重试机制
  - 用户得到适当的错误提示

## 测试环境要求
1. Chrome浏览器（最新版本）
2. 各种内容类型的测试页面
3. 网络连接（用于在线功能）
4. 不同屏幕尺寸（用于UI测试）

## 测试数据要求
1. 具有各种内容结构的样本网页
2. 不同元数据格式的测试数据
3. 用于性能测试的大数据集
4. 多语言内容（用于国际化测试）

## 测试执行说明
1. 所有测试用例应按顺序执行
2. 每个测试用例执行后需记录结果
3. 发现的问题需及时记录并分类
4. 回归测试在每次代码更新后执行

## 问题报告模板
```markdown
### 问题报告

- **测试用例ID**: TC-XXX
- **严重程度**: [严重/中等/轻微]
- **优先级**: [高/中/低]
- **状态**: [新建/进行中/已解决/已验证]
- **描述**:
  [详细描述问题]
- **重现步骤**:
  1. [步骤1]
  2. [步骤2]
  ...
- **预期结果**:
  [描述预期结果]
- **实际结果**:
  [描述实际结果]
- **环境信息**:
  - Chrome版本:
  - 操作系统:
  - 扩展版本:
